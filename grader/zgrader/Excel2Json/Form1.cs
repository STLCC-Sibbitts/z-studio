using System;
using System.IO;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Data.Linq.SqlClient.Implementation;
using System.Text;
using System.Windows.Forms;
using System.Diagnostics;
using Microsoft.Office.Interop.Excel;
using Newtonsoft.Json;
using Newtonsoft.Json.Linq;
using Newtonsoft.Json.Converters;
using Grader;

//using System;
//using System.Collections.Generic;
//using System.Linq;
//using System.Text;
//using System.Net;
//using Newtonsoft.Json;
//using Newtonsoft.Json.Linq;


//namespace JSONTest
//{
//    class Program
//    {
//        static void Main(string[] args)
//        {
//            WebClient c = new WebClient();
//            var data = c.DownloadString("http://localhost/json.php");
//            //Console.WriteLine(data);
//            JObject o = JObject.Parse(data);
//            Console.WriteLine("Name: " + o["name"]);
//            Console.WriteLine("Email Address[1]: " + o["email"][0]);
//            Console.WriteLine("Email Address[2]: " + o["email"][1]);
// {"name":"masnun","email":["masnun@gmail.com","masnun@leevio.com"],"websites":{"home page":"http:\/\/masnun.com","blog":"http:\/\/masnun.me"}}
//            Console.WriteLine("Website [home page]: " + o["websites"]["home page"]);
//            Console.WriteLine("Website [blog]: " + o["websites"]["blog"]);
//            Console.ReadLine();

//        }
//    }
//}
				//{""$F$20"":{""Name"":""$F$20"",""Type"":""Cell"",""Value"":""45.75"",""Text"":""$45.75 "",
				//    ""Formula"":""=IF(E20 > 0, D20*E20, \""\"")"",
				//    ""Dependents"":""$F$27:$F$29,$F$31,$F$34"",""Precedents"":""$D$20:$E$20""}},

namespace Excel2Json
{
	public partial class Form1 : Form
	{
		public Form1()
		{
			//GradeIt();
			//Example();
			//TestIt();
			InitializeComponent();
			//txtJson.Text = ZExcelToJson.BorderTypes();
		}
		public void GradeIt()
		{
			#region doc
			string doc =
			@"{
				""Name"":""WizardWorks Order Form-key.xlsx"",
				""Type"":""Workbook"",
				""Worksheets"":
				[
					{""Order Form"":{""Name"":""Documentation"",""Type"":""Sheet"",
					""Cells"":
					[
						{""$F$20"":{""Name"":""$F$20"",""Type"":""Cell"",""Value"":""45.75"",""Text"":""$45.75 "",
							""Formula"":""=IF(E20 > 0, D20*E20, \""\"")"",
							""Dependents"":""$F$27:$F$29,$F$31,$F$34"",""Precedents"":""$D$20:$E$20""}},
						{""$F$21"":{""Name"":""$F$21"",""Type"":""Cell"",""Value"":""51.8"",""Text"":""$51.80 "",
							""Formula"":""=IF(E21 > 0, D21*E21, \""\"")"",
							""Dependents"":""$F$27:$F$29,$F$31,$F$34"",""Precedents"":""$D$21:$E$21""}},
						{""$F$22"":{""Name"":""$F$22"",""Type"":""Cell"",""Value"":""55.25"",""Text"":""$55.25 "",
							""Formula"":""=IF(E22 > 0, D22*E22, \""\"")"",
							""Dependents"":""$F$27:$F$29,$F$31,$F$34"",""Precedents"":""$D$22:$E$22""}},
						{""$F$23"":{""Name"":""$F$23"",""Type"":""Cell"",""Value"":"""",""Text"":"""",
							""Formula"":""=IF(E23 > 0, D23*E23, \""\"")"",
							""Dependents"":""$F$27:$F$29,$F$31,$F$34"",""Precedents"":""$D$23:$E$23""}},
						{""$F$24"":{""Name"":""$F$24"",""Type"":""Cell"",""Value"":"""",""Text"":"""",
							""Formula"":""=IF(E24 > 0, D24*E24, \""\"")"",
							""Dependents"":""$F$27:$F$29,$F$31,$F$34"",""Precedents"":""$D$24:$E$24""}},
						{   ""$F$25"":
								{	""Name"":""$F$25"",
									""Type"":""Cell"",
									""Value"":"""",""Text"":"""",
									""Formula"":""=IF(E25 > 0, D25*E25, \""\"")"",
									""Dependents"":""$F$27:$F$29,$F$31,$F$34"",
									""Precedents"":""$D$25:$E$25""}}					]
				}}]
			}";
			#endregion
			// For a formula rubric, if the user enters the value instead of the formula, the deduction will be based
			// on whatever the global setting is
			// For scenarios of type "Correct", 
			#region rubricAsString
			string rubric = @"{
				""Step"": {""ID"":""7a"",
				""Text"":""In cell F20, enter an IF function that tests whether the order quantity in cell E20 is greater than 0(zero). If it is, return the value of cell E20 multiplied by cell D20; otherwise, return no text by entering “”"",
				""Pts"":5,
				""Location"":
				{
					""Type"":""Cell"",
					""Worksheets"":""Sheet1"", 
					""Cells"":""$F$20"",
					""Target"":""Worksheets[Sheet1].Cells[$F$20]"" 
				},
				""Type"":""Formula"",
				""Scenarios"": 
				[
					""Correct"":{""Worksheets[Sheet1].Cells[$F$20].Formula"": ""=IF(E20>0,D20*E20,\""\"")""},
					""Alternates"":
					{
						""Worksheets[Sheet1].Cells[$F$20].Formula"":
						[ 
							""=IF(E20 > 0, D20*E20, \""\"")"",
							""=IF(E20>0,D20*E20, \""\"")"",
							""=IF(E20>0,E20*D20,\""\"")"",
							""=IF(E20>0,E20*D20, \""\"")"",
							""=IF(E20>0,D20*E20,\"" \"")"" 
						]
					},
					{
						""Type"": ""Alternate"",
						""Subtype"": ""Partial"",
						""Points"":4,
						""Feedback"":""results are correct, but expression tests the price instead of the order quantity"",
						""Formulas"": 
						[ 
							""=IF(D20 > 0, D20*E20, \""\"")"",
							""=IF(D20>0,D20*E20, \""\"")"",
							""=IF(D20>0,E20*D20,\""\"")"",
							""=IF(D20>0,E20*D20, \""\"")"",
							""=IF(D20>0,D20*E20,\"" \"")"" 
						]
					},
					{
						""Type"": ""Error"",
						""Subtype"": ""Partial"",
						""Points"":3,
						""Feedback"":""false condition omitted"",
						""Formulas"": 
						[ 
							""=IF(E20>0,D20*E20)"",
							""=IF(E20 > 0, D20*E20 )"",
							""=IF(E20>0,D20*E20 )"",
							""=IF(E20>0,E20*D20)"",
							""=IF(E20>0,E20*D20 )""
						],
						""Value"":""45.75"",""Text"":""$45.75 "", 
						""Dependents"":""$F$27:$F$29,$F$31,$F$34"",""Precedents"":""$D$20:$E$20""
					},
					{
						""Type"": ""ErrorConceptual"",
						""Points"":3,
						""Feedback"":""false condition omitted"",
						""Formulas"": 
						[ 
							""=IF(E20>0,D20*E20)"",
							""=IF(E20 > 0, D20*E20 )"",
							""=IF(E20>0,D20*E20 )"",
							""=IF(E20>0,E20*D20)"",
							""=IF(E20>0,E20*D20 )""
						],
						""Value"":""45.75"",
						""Text"":""$45.75 "", 
						""Dependents"":""$F$27:$F$29,$F$31,$F$34"",
						""Precedents"":""$D$20:$E$20""
					}
				]
			}}";
#endregion
			string dir = @"../../../Grader/json";
#if false
			using (StreamReader infile = new StreamReader(dir + "/rubric.json"))
			{
				rubric = infile.ReadToEnd();
			}
			using (StreamReader infile = new StreamReader(dir + "/work3.json"))
			{
				doc = infile.ReadToEnd();
			}
#endif
			JObject docJson = JObject.Parse(doc);
			JToken testTok = docJson.SelectToken("Worksheets[Order Form].Cells[$F$21].Value");
			JObject rubricJson = JObject.Parse(rubric);
			#region parse it local
			if (false)
			{
				string delim = "";
				JToken aTok, vTok;
				JToken steps = rubricJson["Steps"];
				if (steps.Type != JTokenType.Array)
				{
					Debug.WriteLine("Ooops!");
					return;
				}

				foreach (JToken tok in rubricJson["Steps"].Children())
				{
					Debug.WriteLine(tok["Name"].Value<string>());
					foreach (JToken task in tok["Tasks"].Children())
					{
						Debug.WriteLine("Task.Name:" + task["Name"].Value<string>());
						Debug.WriteLine("Scenarios");
						foreach (JToken scenario in task["Scenarios"].Children())
						{
							Debug.WriteLine("Scenario.Name:" + scenario["Name"].Value<string>());
							aTok = scenario["Answer"];
							if (aTok.Type == JTokenType.Array)
							{
								foreach (JToken aa in aTok.Children())
								{
									vTok = aa["Value"];
									Debug.Write("Answer.Path:" + aa["Path"].Value<string>());
									if (vTok.Type == JTokenType.Array)
									{
										delim = "";
										Debug.Write(", Answer.Values:[");
										foreach (JToken av in vTok.Children())
										{
											Debug.Write(delim + av.Value<string>());
											delim = ", ";
										}
										Debug.WriteLine("]");
									}
									else
										Debug.WriteLine(", Answer.Value:" + vTok.Value<string>());
								}
							}
							else
							{
								vTok = aTok["Value"];
								if (vTok.Type == JTokenType.Array)
								{
									delim = "";
									Debug.Write(", Answer.Values[");
									foreach (JToken av in vTok.Children())
									{
										Debug.Write(delim + av.Value<string>());
										delim = ", ";
									}
									Debug.WriteLine("]");
								}
								else
									Debug.WriteLine(", Answer.Value:" + vTok.Value<string>());
							}
						}
					}
				}
			}
			#endregion
			Grader.Grader grader = new Grader.Grader(docJson);
			if (grader.CheckRubric(rubricJson))
			{
				using (StreamWriter outfile = new StreamWriter(dir + "/work3Graded.json"))
				{
					grader.Flush();
					outfile.Write(grader.ToString());
				}
			}
			grader = null;
			//string location = rubricJson["Step"]["Location"].Value<string>("Worksheets");
			//string rType = rubricJson["Step"]["Type"].Value<string>();
			//IList<JObject> scenarios = rubricJson["Step"].SelectToken(@"Scenarios").Select(s => (JObject)s).ToList();
			//JObject scenario = scenarios[0];
			//scenario = scenarios[2];
			//JToken	ptToken;
			//bool foundIt = scenario.TryGetValue("Point", out ptToken);
			//double pts = scenario["Points"].Value<double>();
			//IList<string> formulas = scenario.SelectToken(@"Formulas").Select(s => (string)s).ToList();
			//bool results = grader.CheckRubric(rubricJson);

		}
		public void Example()
		{
		  JObject o = JObject.Parse(@"{
			""Stores"": [
			  ""Lambton Quay"",
			  ""Willis Street""
			],
			""Manufacturers"": [
			  {
				""Name"": ""Acme Co"",
				""Products"": [
				  {
					""Name"": ""Anvil"",
					""Price"": 50
				  }
				]
			  },
			  {
				""Contoso"" : {
					""Name"": ""Contoso"",
					""Products"": [
					  { 123: { ""Name"": ""Elbow Grease"", ""Price"": 99.95 } },
					  { 234: { ""Name"": ""Headlight Fluid"", ""Price"": 4 } }
					]
				}
			  }
			]
		  }");
			// Levenshtein stuff
		  // http://www.atalasoft.com/cs/blogs/stevehawley/archive/2009/01/26/string-similarity-and-extension-methods.aspx
		  // http://stackoverflow.com/questions/473522/word-comparison-algorithm                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
		  // String prodPath = @"Manufacturers[Contoso].Products[123]";
		  JObject prod123 = (JObject) o["Manufacturers"].Children()["Contoso"]["Products"].Children()["123"].First();
		  JObject parent123 = (JObject)prod123.Parent.Ancestors().First().Parent.First();

		  JToken tokContoso = o.SelectToken(@"Manufacturers.Children()[""Contoso""]");
		  //JObject objContoso = (JObject) tokContoso.ToObject(<JObject> );
		 // string name = (string)o.SelectToken(@"Manufacturers.Children()[""Contoso""].Name");
//		  JToken tokContoso = o.SelectToken(@"Manufacturers.Children()[""Contoso""]");
		  // Acme Co
			if ( true )
				return;
		  decimal productPrice = (decimal)o.SelectToken("Manufacturers[0].Products[0].Price");
		  // 50

		  string productName = (string)o.SelectToken("Manufacturers[1].Products[0].Name");
		  // Elbow Grease

	 //     Assert.AreEqual("Acme Co", name);
	 //     Assert.AreEqual(50m, productPrice);
	 //     Assert.AreEqual("Elbow Grease", productName);

		  IList<string> storeNames = o.SelectToken("Stores").Select(s => (string)s).ToList();
		  // Lambton Quay
		  // Willis Street

		  IList<string> firstProductNames = o["Manufacturers"].Select(
				m => (string)m.SelectToken("Products[1].Name")).ToList();
		  // null
		  // Headlight Fluid

		  decimal totalPrice = o["Manufacturers"].Sum(m => (decimal)m.SelectToken("Products[0].Price"));
		  // 149.95
	/*
		  Assert.AreEqual(2, storeNames.Count);
		  Assert.AreEqual("Lambton Quay", storeNames[0]);
		  Assert.AreEqual("Willis Street", storeNames[1]);
		  Assert.AreEqual(2, firstProductNames.Count);
		  Assert.AreEqual(null, firstProductNames[0]);
		  Assert.AreEqual("Headlight Fluid", firstProductNames[1]);
		  Assert.AreEqual(149.95m, totalPrice);
	 */
		}
		private JObject o1 = null;
		private JObject o2 = null;

		private void DumpIt1()
		{
			ZExcelToJson zexcel = new ZExcelToJson();
			zexcel.ToJson();
			txtJson.Text = zexcel.ToString();
			o1 = JObject.Parse(zexcel.ToString());
			zexcel = null;
		}
		private void DumpIt2()
		{
			ZExcelToJson zexcel = new ZExcelToJson();
			// open the original file for a particuar step
			// If the Beg (original) for this step doesn't exist, just use the Beg.json file
			// If loading the End (final) for a step doesn't exist, just use the End.json file
			string originalJson = zexcel.currentFolder + @"\keys\03.Beg.json";
			string	doc;
			using (StreamReader infile = new StreamReader(originalJson) )
			{
				doc = infile.ReadToEnd();
			}

			JObject docJson = JObject.Parse(doc);
			string zPath = "Worksheets[Employees].Cells[$J$13].Content.Value";
			if (txtZpath.Text.Length > 0)
			{
				zPath = txtZpath.Text;
			}
			JToken testTok = docJson.SelectToken(zPath);
			if (testTok == null)
				txtJson.Text += "Oops, could not find: '" + zPath + "'\n";
			else
			{
				string tmp = testTok.ToString(Formatting.Indented);
				txtJson.Text += "Found: '" + zPath + "'\n" + tmp + "\n";
			}
			txtJson.Text += "==================================================\n";
//			zexcel.ToJson();
//			txtJson.Text = zexcel.ToString();
//			o2 = JObject.Parse(zexcel.ToString());
			zexcel = null;
		}
		private void DiffIt()
		{
		}
		private void TestIt()
		{
			ZExcelToJson zexcel = new ZExcelToJson( );
			string dir = @"C:/Users/Public/Documents/_zeknotes/grader/zgrader/Excel2Json/zg/NPe3c2";
#region linkStuff
			//            using (StreamReader infile = new StreamReader(dir + "/1-3b01a.json"))
//            {
//                string json = infile.ReadToEnd();
//                JObject o = JObject.Parse(json);

//                // String prodPath = @"Manufacturers[Contoso].Products[123]";
////                var cells2 =
////                    from p in o["Worksheets"].Children()["Sheet1"]["Cells"].Children()
////                    let val = (string)p.Value<string>("Value")
					
////                    let cell = p.Value<string>("Name")
////                    let oObj = (JObject)p.ToObject<JObject>()
////                    let oTok = p.First()
////                    let oVal = oTok.Value<string>("Value")
//////					let oVal = oTk.Children()["Value"] //"" // oTk.Count == 1 ? cell : oTok.Value<string>("Value")
////                    //let oVal = oObj["Value"] == null ? "" : oObj["Value"].Value<string>()
////                    let parentSheet = (JObject)o["Worksheets"].Children()["Sheet1"].First()
////                    where cell == null || val.ToString().Contains("i")
////                    select new { cellName = cell, cellValue = val, oVal, oTok, oObj, parentSheet, p };
////                foreach (var cell in cells)
////                {
////                    Debug.Write(cell + ", " + (string)cell.parentSheet["Name"]);
////                }

//                var cells =
//                    from p in o["Worksheets"].Children()["Sheet1"]["Cells"].Children()
//                    let cell = p.Value<string>("Name")
//                    let oCell = p.Values().First().Value<string>("Name")
//                    let oVal = (string)p.Values().First().Value<string>("Value")
//                    let parentSheet = (JObject)o["Worksheets"].Children()["Sheet1"].First()
//                    where cell == null && oVal.Contains("#") 
//                    select new { cellName = cell, oCell, oVal, parentSheet, p };

//                foreach (var cell in cells)
//                {
//                    Debug.Write(cell + ", " + (string)cell.parentSheet["Name"]);
//                }

	
//                var rangeNames =
//                  from p in o["Worksheets"].Children()["Sheet1"]["Ranges"].Children()
//                  where p.Value<string>("Type") == "Fill"
//                  select p.Value<string>("Range");

//                foreach (var range in rangeNames)
//                {
//                    Debug.Write(range);
//                }

//                var topItems =
//                  from c in o["worksheets"].Values<string>()
//                  group c by c into g
//                  orderby g.Count() descending
//                  select new { Category = g.Key, Count = g.Count() };

//                foreach (var c in topItems)
//                {
//                    Console.WriteLine(c.Category + " - Count: " + c.Count);
//                }

			//            }

#endregion

			foreach (string filename in Directory.EnumerateFiles(dir, "Wiz*.xlsx"))
			{
				zexcel.ToJson(filename);	// "C:/Users/Public/Documents/_zeknotes/grader/zgrader/Excel2Json/Simnet1-3bKey.xlsx");
				string jsonfn = filename.Replace("xlsx", "json");
				using (StreamWriter outfile = new StreamWriter(jsonfn))
				{
					zexcel.Flush();
					outfile.Write(zexcel.ToString());
				}
				zexcel.Reset();
				string contents = zexcel.ToString();
			}
			zexcel = null;
			return;
#region stuff
//            var j2 = File.ReadAllText("../../test4.json");
//            JObject jobj2 = JObject.Parse(j2);
//            var sht2_0 = jobj2["spreadsheet"];
//            JArray sht2_1 = (JArray)sht2_0["Worksheets"];
//            var sht2_2 = sht2_1.Values("Sheet1").First();
//            JArray c2 = (JArray)sht2_2["Cells"];
//            // 	{ "$A$1": { "Name": "A1", "Type": "Cell", "Value": "Greek Yogurt Recipe", "Value1": "Greek Yogurt Recipe", "Value2": "", "Style": "Title", "Fill": "255, 255, 255" } },
			
//            JToken jc = c2.Values("$A$1").First();
//            string v1 = jc.Value<string>("Type");
//            v1 = jc.Value<string>("Value");
//            v1 = jc.Value<string>("Style");
//            v1 = jc.Value<string>("Fill");


//            var jcv = jc.Type.ToString();
//            var json = File.ReadAllText("../../test3.json");
//            var jobject = JObject.Parse(json);

//            //			JToken cell = jobject.SelectToken(@"..Cells[Name=""$A$1""]"); 
			
////			JToken wksht = jobject.SelectToken( @"spreadsheet.Worksheets[0]");
//            JToken wksht1; // = jobject.SelectToken(@"spreadsheet.Worksheets").Values(@"Sheet1").First();
//            wksht1 = jobject.SelectToken(@"spreadsheet.Worksheets.Sheet1");
////			JToken cells; // = wksht.SelectToken(@"Sheet1.Cells");
//            JToken cell;
//            cell = jobject.SelectToken(@"spreadsheet.Worksheets.Sheet1.Cells.$A$1");
			
//            cell = jobject.SelectToken(@"spreadsheet.Worksheets.Sheet1.Cells.$B$1");
//            //cell = wksht1.SelectToken(@"Cells").Values(@"$A$1").First();
////			cell = cells.ToDictionary(["$A$1"];
//            //cell = cells.Values(@"$A$1").First();
//            //cell = cells[@"$A$1"];
//            //JObject joCells = (JObject)cells;
//            var item = cell; // = jobject.Property( "Worksheets");
//            //item = joCells.Property("$A$1");

//            if (item.HasValues)
//            {
//                foreach (var item2 in item.Values())
//                {
//                    Debug.Print(item2.Value<string>("Name") + ", type:" + item2.Value<string>("Type"));
//                    if (item2.Children().Count() > 0)
//                    {
//                        foreach (var item3 in item2.Children())
//                        {
//                            if (item3.Children().Count() > 0)
//                            {
//                                foreach (var item4 in item3.Children())
//                                {
//                                    if (item4.Contains("Name") && item4.Contains("Type") && item4.Contains("Value"))
//                                        Debug.Print(item4.Value<string>("Name") + ", type:" + item4.Value<string>("Type")
//                                            + ", value:" + item4.Value<string>("Value"));
//                                }
//                            }
//                        }
//                    }
//                }
//            }
////			var value = item.Value<string>("Value");
////			Debug.Print("Found:[" + value + "] in cell A1");
//            //			Console.WriteLine(value); 
			#endregion
		}
		private void button1_Click(object sender, EventArgs e)
		{
			GradeIt();
//			ZExcel zexcel = new ZExcel("C:/Users/Public/Documents/_zeknotes/grader/zgrader/Excel2Json/E4C3Mitchell Oil.xlsx");
			//ZExcelToJson zexcel = new ZExcelToJson();
			//zexcel.ToJson( "C:/Users/Public/Documents/_zeknotes/grader/zgrader/Excel2Json/Simnet1-3bKey.xlsx");
			//zexcel = null;
			//StringBuilder sb = new StringBuilder();
			//StringWriter sw = new StringWriter(sb);
 
			//using (JsonWriter jsonWriter = new JsonTextWriter(sw))
			//{
			//  jsonWriter.Formatting = Formatting.Indented;
 
			//  jsonWriter.WriteStartObject( );
			//  jsonWriter.WritePropertyName("CPU");
			//  jsonWriter.WriteValue("Intel");
			//  jsonWriter.WritePropertyName("PSU");
			//  jsonWriter.WriteValue("500W");
			//  jsonWriter.WritePropertyName("Drives");
			//  jsonWriter.WriteStartArray();
			//      jsonWriter.WriteValue("DVD read/writer");
			//      jsonWriter.WriteComment("(broken)");
			//      jsonWriter.WriteValue("500 gigabyte hard drive");
			//      jsonWriter.WriteValue("200 gigabype hard drive");
			//  jsonWriter.WriteEnd();

			//  jsonWriter.WriteEndObject();
			//  Debug.WriteLine(sw.ToString());
			
			//}

			//// {
			////   "CPU": "Intel",
			////   "PSU": "500W",
			////   "Drives": [
			////     "DVD read/writer"
			////     /*(broken)*/,
			////     "500 gigabyte hard drive",
			////     "200 gigabype hard drive"
			////   ]
			//// }

		}

		private void btnDumpIt_Click(object sender, EventArgs e)
		{
			DumpIt2();
		}
	}
}
